/**
* @css --energy-icon-orientation: [left|right]
* @attribute energy-class
* @attribute icon-orientation [left|right]
*/
class EnergyIcon extends HTMLElement
{
	constructor ()
	{
		super();
		this.attachShadow({mode:'open'});
		this.shadowRoot.innerHTML = `
			<style>
				:host {
					height: 1.3em;
					display: none;
					--color-a: #33a357;
					--color-b: #79b752;
					--color-c: #c3d545;
					--color-d: #fff12c;
					--color-e: #edb731;
					--color-f: #d66f2c;
					--color-g: #cc232a;
					--label-color: var(--color-a);
					--border-color: black;
				}
				#bg {
					fill: var(--label-color);
					stroke: none;
				}
				#cls {
					fill: white;
					stroke: var(--border-color);
					stroke-width: 1px;
				}
				#scale {
					fill: white;
					stroke: none;
				}
				.scale_char {
					fill: black;
					stroke: none;
				}
				#scale_line {
					stroke: black;
					stroke-width: 3px;
				}
				#scale_triangle {
					fill: black;
					stroke: none;
				}
				#border {
					fill: none;
					stroke: var(--border-color);
					stroke-width: 1px;
				}
			</style>
			<svg height="100%" viewBox="-0.5 -0.5 125 69" preserveAspectRatio="none">
				<defs>
					<path id="A" d="m 16.992456,16.099974 q 0.351563,1.054687 0.439454,1.669922 0.08789,0.615234 -0.234375,0.9375 -0.322266,0.292968 -1.142579,0.351562 -0.820312,0.08789 -2.255859,0.08789 -1.494141,0 -2.34375,-0.05859 -0.820312,-0.0293 -1.259766,-0.146484 Q 9.7561283,18.795286 9.5803471,18.560911 9.4045658,18.326536 9.2873783,17.945677 L 6.7385502,10.328489 H -7.4997311 l -2.4023437,7.41211 q -0.1171872,0.410156 -0.3222652,0.703125 -0.175782,0.263672 -0.615235,0.439453 -0.410156,0.146484 -1.201172,0.205078 -0.761718,0.05859 -2.021484,0.05859 -1.347656,0 -2.109375,-0.08789 -0.761719,-0.08789 -1.054688,-0.410156 -0.292968,-0.351563 -0.205078,-0.966797 0.08789,-0.615234 0.439453,-1.640625 l 11.6894536,-33.632813 q 0.1757812,-0.498046 0.4101562,-0.791015 0.234375,-0.322266 0.7324219,-0.46875 0.5273437,-0.175781 1.4355469,-0.205078 0.9082031,-0.05859 2.40234371,-0.05859 1.72851559,0 2.75390629,0.05859 1.0253906,0.0293 1.5820312,0.205078 0.5859375,0.146484 0.8203125,0.46875 0.2636719,0.322265 0.4394531,0.878906 z M -0.40988731,-11.702761 h -0.0292969 L -5.8005123,4.4105206 H 4.9514408 Z"/>
					<path id="B" d="m 13.729767,7.6371498 q 0,2.0214844 -0.556641,3.6621092 -0.55664,1.640625 -1.552734,2.900391 -0.966797,1.259765 -2.3437502,2.167969 -1.3476562,0.908203 -2.9882812,1.49414 -1.640625,0.585938 -3.515625,0.878906 -1.84570313,0.263672 -4.1308594,0.263672 H -11.436249 q -0.966797,0 -1.640625,-0.55664 -0.644531,-0.585938 -0.644531,-1.875 v -33.046875 q 0,-1.289063 0.644531,-1.845703 0.673828,-0.585938 1.640625,-0.585938 h 9.5214846 q 3.4863281,0 5.8886719,0.585938 2.4316406,0.585937 4.0722656,1.787109 1.6699219,1.171875 2.5488279,2.988281 0.878906,1.816406 0.878906,4.2773439 0,1.3769532 -0.351562,2.6074219 -0.351563,1.2011719 -1.025391,2.1972656 -0.6738278,0.9960938 -1.6699215,1.7578125 -0.9667969,0.7617188 -2.2265625,1.2304688 1.6113281,0.2929687 2.9589843,1.02539061 1.3769527,0.73242188 2.3730467,1.90429689 1.025391,1.1425781 1.611328,2.6953125 0.585938,1.5527344 0.585938,3.4863281 z M 3.7688293,-8.3296471 q 0,-1.1425781 -0.3515625,-2.0507809 -0.3515625,-0.908203 -1.0546875,-1.494141 -0.703125,-0.615234 -1.78710933,-0.9375 -1.0546875,-0.322266 -2.84179687,-0.322266 h -3.8964844 v 9.8437504 h 4.3066406 q 1.66992192,0 2.66601567,-0.3808593 0.99609373,-0.4101563 1.64062503,-1.0839844 0.6738281,-0.703125 0.9960937,-1.6113281 0.3222656,-0.9375 0.3222656,-1.9628907 z M 5.73172,7.9008217 q 0,-1.3183594 -0.4394532,-2.34375 Q 4.8528137,4.5023842 4.0032043,3.7992592 3.153595,3.0961342 1.8352356,2.7152748 0.51687622,2.3344154 -1.5924988,2.3344154 H -6.1628113 V 13.115665 h 5.56640627 q 1.61132813,0 2.69531253,-0.322265 Q 3.2121887,12.441837 4.0032043,11.797306 4.8235168,11.123478 5.26297,10.156681 5.73172,9.1605873 5.73172,7.9008217 Z"/>
					<path id="C" d="m 14.00913,13.256481 q 0,0.732422 -0.05859,1.259766 -0.0293,0.498047 -0.117188,0.878906 -0.08789,0.351563 -0.234375,0.615234 -0.146484,0.263672 -0.46875,0.615235 -0.322265,0.322265 -1.259765,0.849609 -0.908204,0.527344 -2.2558598,1.025391 -1.3183593,0.46875 -3.046875,0.791015 -1.6992187,0.322266 -3.6914062,0.322266 -3.8964844,0 -7.03125,-1.201172 -3.1347656,-1.201172 -5.3320313,-3.574219 -2.1972657,-2.402343 -3.3691407,-5.9765621 -1.171875,-3.5742187 -1.171875,-8.32031248 0,-4.83398442 1.289063,-8.58398442 1.289062,-3.75 3.6035152,-6.298828 2.3144532,-2.548828 5.5371094,-3.867188 3.25195313,-1.318359 7.1484375,-1.318359 1.5820313,0 3.046875,0.263672 1.4648438,0.263672 2.6953125,0.703125 1.2597654,0.410156 2.2558594,0.966797 0.996094,0.55664 1.376953,0.966797 0.410156,0.380859 0.556641,0.644531 0.146484,0.263672 0.234375,0.673828 0.08789,0.410156 0.117187,0.966797 0.05859,0.556641 0.05859,1.376953 0,0.878906 -0.05859,1.494141 -0.05859,0.615234 -0.205078,0.996093 -0.146484,0.38086 -0.351562,0.556641 -0.205079,0.1757813 -0.46875,0.1757813 -0.439454,0 -1.113282,-0.4980473 -0.673828,-0.527343 -1.7578121,-1.142578 -1.0546875,-0.644531 -2.5488282,-1.142578 -1.4648437,-0.527344 -3.515625,-0.527344 -2.2558593,0 -4.04296872,0.9375 -1.75781248,0.908204 -3.01757808,2.6367192 -1.2304688,1.6992187 -1.875,4.1308593 -0.6445313,2.4316407 -0.6445313,5.47851567 0,3.33984373 0.6738281,5.80078123 0.703125,2.4316406 1.9628907,4.0136719 1.2890625,1.5820317 3.07617183,2.3730467 1.81640627,0.761719 4.07226567,0.761719 2.0507812,0 3.5449218,-0.46875 1.4941407,-0.498047 2.5488283,-1.083984 1.083984,-0.585938 1.757812,-1.054688 0.703125,-0.46875 1.083985,-0.46875 0.292968,0 0.46875,0.117188 0.175781,0.117187 0.292968,0.46875 0.117188,0.351562 0.175782,0.996093 0.05859,0.615235 0.05859,1.669922 z"/>
					<path id="D" d="m 15.709778,-0.55351067 q 0,5.21484377 -1.376953,8.93554687 -1.347657,3.6914058 -3.896485,6.0351558 -2.5488278,2.34375 -6.2109372,3.457032 -3.63281247,1.083984 -8.671875,1.083984 h -9.0527348 q -0.966796,0 -1.640625,-0.556641 -0.644531,-0.585937 -0.644531,-1.875 v -33.046875 q 0,-1.289062 0.644531,-1.845703 0.673829,-0.585937 1.640625,-0.585937 h 9.726563 q 5.0683593,0 8.5839843,1.201172 3.5449219,1.171875 5.9472657,3.515625 2.431641,2.314453 3.691406,5.7421872 1.259766,3.4277344 1.259766,7.93945313 z m -7.9687502,0.26367188 q 0,-2.69531251 -0.6445312,-5.00976561 -0.6152344,-2.3144531 -2.0214844,-4.0136719 -1.3769531,-1.6992187 -3.5742187,-2.6367187 -2.16796879,-0.966797 -5.7128907,-0.966797 h -3.8964843 v 25.78125 h 4.0136718 q 3.16406253,0 5.3320313,-0.820312 Q 3.4050903,11.223833 4.8406372,9.5832081 6.305481,7.9132862 7.008606,5.4523487 7.7410278,2.9914112 7.7410278,-0.28983879 Z"/>
					<path id="E" d="m 11.21471,15.946436 q 0,0.849609 -0.08789,1.435547 -0.05859,0.55664 -0.205079,0.908203 -0.146484,0.351562 -0.380859,0.527344 -0.205078,0.146484 -0.46875,0.146484 H -8.9708366 q -0.9667969,0 -1.6406254,-0.556641 -0.644531,-0.585937 -0.644531,-1.875 v -33.046875 q 0,-1.289062 0.644531,-1.845703 0.6738285,-0.585937 1.6406254,-0.585937 H 9.9549446 q 0.2636714,0 0.4687504,0.146484 0.205078,0.146485 0.351562,0.527344 0.146484,0.351562 0.205078,0.9375 0.08789,0.556641 0.08789,1.435547 0,0.820312 -0.08789,1.40625 -0.05859,0.55664 -0.205078,0.908203 -0.146484,0.351562 -0.351562,0.527344 -0.205079,0.146484 -0.4687504,0.146484 H -3.5802116 v 9.2578126 H 7.8748665 q 0.2636719,0 0.46875,0.1757812 0.234375,0.1464844 0.3808594,0.4980469 0.1464843,0.3222656 0.2050781,0.9082031 0.087891,0.5566406 0.087891,1.37695313 0,0.84960937 -0.087891,1.40625 Q 8.8709602,1.2687016 8.7244759,1.6202641 8.5779915,1.9425297 8.3436165,2.0890141 8.1385384,2.2354984 7.8748665,2.2354984 H -3.5802116 V 12.928858 H 10.072132 q 0.263672,0 0.46875,0.175781 0.234375,0.146484 0.380859,0.498047 0.146485,0.351562 0.205079,0.9375 0.08789,0.556641 0.08789,1.40625 z"/>
					<path id="F" d="m 10.619127,-15.914118 q 0,0.878906 -0.08789,1.494141 -0.05859,0.585937 -0.234375,0.9375 -0.146485,0.351562 -0.3515629,0.527344 -0.2050781,0.175781 -0.46875,0.175781 H -2.916029 V -2.5840397 H 8.7148304 q 0.2636719,0 0.46875,0.1464844 0.2050781,0.1464844 0.3515625,0.4980469 0.1757812,0.3515625 0.234375,0.9375 0.087891,0.58593746 0.087891,1.46484371 0,0.87890629 -0.087891,1.46484379 Q 9.7109241,2.5136166 9.5351429,2.8944759 9.3886585,3.2753353 9.1835804,3.4511166 8.9785023,3.5976009 8.7148304,3.5976009 H -2.916029 V 17.718695 q 0,0.322265 -0.1757812,0.55664 -0.1757813,0.234375 -0.6445313,0.410157 -0.4394531,0.146484 -1.171875,0.234375 -0.7324219,0.08789 -1.875,0.08789 -1.1132812,0 -1.875,-0.08789 -0.7324219,-0.08789 -1.171875,-0.234375 -0.4394535,-0.175782 -0.6445315,-0.410157 -0.175781,-0.234375 -0.175781,-0.55664 V -16.64654 q 0,-1.289062 0.644531,-1.845703 0.6738284,-0.585937 1.6406253,-0.585937 H 9.4765491 q 0.2636719,0 0.46875,0.175781 0.2050779,0.146484 0.3515629,0.527344 0.175781,0.351562 0.234375,0.966797 0.08789,0.615234 0.08789,1.49414 z"/>
					<path id="G" d="m 16.234776,-13.06204 q 0,0.849609 -0.08789,1.464843 -0.05859,0.615235 -0.205078,0.996094 -0.117188,0.351563 -0.322266,0.498047 -0.175781,0.1464844 -0.439453,0.1464844 -0.380859,0 -1.230469,-0.5273434 -0.849609,-0.527344 -2.255859,-1.142578 -1.40625,-0.615235 -3.3691407,-1.142579 -1.9335938,-0.527343 -4.5117188,-0.527343 -2.7539062,0 -4.9804687,0.966797 -2.2265625,0.9375 -3.8085938,2.695312 -1.5820312,1.7285157 -2.4316406,4.1894532 -0.8496094,2.4316406 -0.8496094,5.39062497 0,3.25195313 0.8496094,5.74218753 0.8789063,2.4609375 2.4316406,4.1308593 1.5527344,1.669922 3.7207032,2.519531 2.19726559,0.84961 4.8339843,0.84961 1.2890625,0 2.5488282,-0.292969 1.2597656,-0.292969 2.34375,-0.878906 V 3.2270222 H 1.2933693 q -0.52734376,0 -0.82031251,-0.6445313 -0.29296875,-0.6738281 -0.29296875,-2.25585935 0,-0.8203125 0.0585938,-1.37695315 0.0878906,-0.5566406 0.234375,-0.8789062 0.14648438,-0.3515625 0.3515625,-0.4980469 Q 1.0296974,-2.603056 1.2933693,-2.603056 H 14.096104 q 0.46875,0 0.820312,0.1757813 0.38086,0.1464844 0.644531,0.46875 0.292969,0.3222656 0.439454,0.7910156 0.146484,0.43945315 0.146484,1.02539065 V 14.945772 q 0,0.878906 -0.322266,1.552735 -0.292968,0.644531 -1.259765,1.02539 -0.9375,0.38086 -2.34375,0.791016 -1.40625,0.410156 -2.9296878,0.703125 -1.4941407,0.292969 -3.046875,0.439453 -1.5234375,0.146484 -3.0761719,0.146484 -4.5410156,0 -8.1445313,-1.289062 -3.5742187,-1.31836 -6.064453,-3.779297 -2.490234,-2.490234 -3.808594,-6.0351563 -1.318359,-3.5742188 -1.318359,-8.08593753 0,-4.65820317 1.40625,-8.34960937 1.40625,-3.7207028 3.984375,-6.2988278 2.5781248,-2.607422 6.2109373,-3.984375 3.66210937,-1.376953 8.1445312,-1.376953 2.4609375,0 4.4824219,0.351562 2.0214846,0.322266 3.5156246,0.820313 1.523438,0.46875 2.519532,1.02539 0.996093,0.556641 1.376953,0.966797 0.410156,0.410156 0.585937,1.171875 0.175782,0.732422 0.175782,2.197266 z"/>
				</defs>
				<polygon id="bg" points="0,0 0,68 92,68 124,34 92,0"/>
				<use id="cls" x="62" y="34"/>
				<g id="gscale">
					<rect id="scale" x="0" y="0" width="28" height="68"/>
					<use class="scale_char" href="#A" x="31" y="30" transform="scale(0.45)"/>
					<use class="scale_char" href="#G" x="30" y="120" transform="scale(0.45)"/>
					<line id="scale_line" x1="14" y1="28" x2="14" y2="41"/>
					<polygon id="scale_triangle" points="9,32 19,32 14,25"/>
				</g>
				<polygon id="border" points="0,0 0,68 92,68 124,34 92,0"/>
			</svg>
		`;
		this.dom = {
			bg: this.shadowRoot.querySelector("#bg"),
			cls: this.shadowRoot.querySelector("#cls"),
			gscale: this.shadowRoot.querySelector("#gscale"),
			border: this.shadowRoot.querySelector("#border"),
		}
		this.ecs = ["A","B","C","D","E","F","G"];
		window.addEventListener("resize", this._onWindowResize.bind(this));
	}

	static get observedAttributes ()
	{
		return [
			"icon-orientation",
			"energy-class"
		];
	}

	get labelOrientation ()
	{
		return this.getAttribute("icon-orientation");
	}

	set labelOrientation (x)
	{
		if (x != this.labelOrientation) {
			this.setAttribute("icon-orientation", x);
			this._modifyLabel();
		}
	}

	get energyClass ()
	{
		return this.getAttribute("energy-class");
	}

	set energyClass (x)
	{
		x = x.toUpperCase();
		if (this.ecs.includes(x)) {
			this.shadowRoot.host.style.setProperty("display", "flex");
		} else {
			this.shadowRoot.host.style.setProperty("display", "none");
			return;
		}
		if (x != this.energyClass) {
			this.setAttribute("energy-class", x);
		}
		this.dom.cls.setAttribute("href", '#'+x);
		this.shadowRoot.host.style.setProperty('--label-color', 'var(--color-'+x.toLowerCase()+')');
	}

	attributeChangedCallback (name, oldVal, newVal)
	{
		switch(name){
			case "icon-orientation":
				this.labelOrientation = newVal; break;
			case "energy-class":
				this.energyClass = newVal; break;
		}
	}

	connectedCallback ()
	{
		this.labelOrientation = 'right';
		this._onWindowResize();
	}

	_onWindowResize ()
	{
		let orient = window.getComputedStyle(this).getPropertyValue('--energy-icon-orientation').trim();
		if (orient) {
			this.labelOrientation = orient;
		}
	}

	_modifyLabel ()
	{
		if (this.labelOrientation == 'left') {
			this.dom.bg.setAttribute("points", "32,0 0,34 32,68 124,68 124,0");
			this.dom.border.setAttribute("points", "32,0 0,34 32,68 124,68 124,0");
			this.dom.gscale.setAttribute("transform", "translate(96,0)");
		} else {
			this.dom.bg.setAttribute("points", "0,0 0,68 92,68 124,34 92,0");
			this.dom.border.setAttribute("points", "0,0 0,68 92,68 124,34 92,0");
			this.dom.gscale.removeAttribute("transform");
		}
	}

}
window.customElements.define("energy-icon", EnergyIcon);
